<!DOCTYPE html>
<html>
<head>
   <title>Introduction &gt; Platform Architectures &gt; Alpha Architecture &gt; Exceptions, Faults, Interrupts, and MachineChecks &gt; Exception Source Bitmask</title>
   <meta name="viewport" content="width=device-width, initial-scale=1">
   <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />   
   <meta http-equiv="X-UA-Compatible" content="IE=edge" />
   <meta name="generator" content="Help &amp; Manual" />
   <meta name="keywords" content="ALPHA_EXCEPTION_SRC_BITMASK,Bitmask,Exception,Instruction Bitmask,Macro, ALPHA_EXCEPTION_SRC_BITMASK,ra, Operand,rb, Operand,rc, Operand" />
   <meta name="description" content="Purpose and Implementation in Alpha AXP Emulation &nbsp;Overview &nbsp;The Alpha AXP architecture, like many RISC designs, can trigger floating-point exceptions (invalid operation, overf" />
   <link type="text/css" href="default.css" rel="stylesheet" />
   <link type="text/css" href="custom.css" rel="stylesheet" />

   <style TYPE="text/css" media="screen"> 
      html, body { margin:0; 
        padding:0; 
        background: #ffffff; 
      } 
      div#printheader { display: none; }
      #idheader { 
        width:100%; 
        min-height: 60px; 
        padding: 0; 
        margin: 0;
        position: fixed;
        top: 0;
        background: #2C5D88;
        z-index: 2;
      } 
      /* The "min-height" for "#idheader table" ensures that the (blue) header of the topic
         has at least the same height as the header of the navigation panel left of it */
      #idheader table { min-height: 59px;}             
      #idheader h1 span { color: #FFF }     
      #idnav {
        text-align: right;
        width: 126px;
        vertical-align: middle;        
      } 
      #idnav a { text-decoration: none }
      #idnav span {
        display: inline-block;
        width: 24px;
        height: 24px;
        margin-left: 4px;
        background:url('hm_webhelp_buttons_grey.png') top left no-repeat;
      } 
      #idnav a span {
        background-image:url('hm_webhelp_buttons_white.png');
      } 
      #idnav a span:hover {
        background-image:url('hm_webhelp_buttons_orange.png');
      } 
      #idnav span.hmbtnprev { background-position: 0 -32px }
      #idnav span.hmbtnnext { background-position: -24px -32px }
      #idnav span.hmbtntop  { background-position: -48px -32px }
      #idnav span.hmbtntoggle  { width: 20px; background-position: -70px -32px }
      #idnav span.hmbtnprint  { background-position: -88px -32px }

      #callout-table, #overview-table {display:block; position:relative; top:0; left:0;}
      #callout-icon {display:block; position:absolute; top:-11px; left:-11px;}
      #callout-icon-flag {display:block; position:absolute; top:-11px; left:-8px;}
      #callout-table a {text-decoration: none; color: blue;}
      #callout-table a:visited {text-decoration: none; color: blue;}
      #overview-table a {text-decoration: none; color: black;}
      #overview-table a:visited {text-decoration: none; color: black;}
      #callout-table a:hover, #overview-table a:hover {text-decoration: underline;}       
      p.help-url { margin: 20px 0 5px 0; text-align: center; }
	  p.help-url a:link { font-size: 50%; text-decoration: none; color: black; }
	  p.help-url a:visited { color: black; }
	  p.help-url a:hover { font-size: 95%; text-decoration: underline; }
      #switchtoggles { text-align: right; padding: 0 2px 0 0; font-size: 90%; } 
      .sync-toc { color: #FFF; font-size: 8pt; font-weight: bold; display: none; }
      .sync-toc a { color: #FFF; text-decoration: none; font-weight: bold;}
      .sync-toc a:visited { color: #FFF; }
      .sync-toc a:hover { text-decoration: underline; }
	  a#printbuttonlink { cursor: pointer; }
      a.hmanchor { display: inline-block; margin-top: -4em; padding-top: 4em; }  
   </style>
   <style TYPE="text/css" media="print">
      div#idheader, img.dropdown-toggle-icon, p.help-url { display:none } 
   </style>
   
   <script type="text/javascript" src="jquery.js"></script>
   <script type="text/javascript" src="helpman_settings.js"></script>
   <script type="text/javascript" src="helpman_topicinit.js"></script>

   <script type="text/javascript">
     HMSyncTOC("index.html", "trapping-exceptions.html");
   </script>
   <script type="text/javascript" src="highlight.js"></script>
   <script type="text/javascript">
     $(document).ready(function(){highlight();});
   </script>
</head>
<body>


<div id="printheader"><h1 class="p_Heading1" style="page-break-after: avoid;"><span class="f_Heading1">Exception Source Bitmask</span></h1>
</div>
<div id="idheader">
<div id="idheaderbg">
<table style="width:100%;border:none;margin:0px;" cellspacing="0" cellpadding="0"> 
  <tr>
    <td class="topichead" style="text-align:left; vertical-align:middle">
      <p class="sync-toc">&lt;&lt; <a rel="nofollow" href="index.html?trapping-exceptions.html" target="_top">Click to Display Table of Contents</a> &gt;&gt;</p>
      <p class="crumbs"><b>Navigation:</b>&nbsp;
      
      <a href="introduction.html">Introduction</a> &gt; <a href="platform-architectures.html">Platform Architectures</a> &gt; <a href="architecture.html">Alpha Architecture</a> &gt; <a href="exceptionsinterruptsandmachinechecks.html">Exceptions, Faults, Interrupts, and MachineChecks</a>&nbsp;&gt;</p>
   
      <h1 class="p_Heading1" style="page-break-after: avoid;"><span class="f_Heading1">Exception Source Bitmask</span></h1>

    </td>
    <td class="topichead" id="idnav">
      
      <a href="exception-frame_exceptionsinterruptsmachinechecks.html" title="Previous Topic"><span class="hmbtnprev"></span></a>
      <a href="exceptionsinterruptsandmachinechecks.html" title="Parent Chapter"><span class="hmbtntop"></span></a>
      <a href="exception-source-bitmask-maski.html" title="Next Topic"><span class="hmbtnnext"></span></a>
      
    </td>
  </tr>  
</table>
</div>
</div>  

<div id="idcontent"><div id="innerdiv">
<!-- Ask Internet Explorer 6.users to update their obsolete and dangerous browser --> 
<!--[if lt IE 7]><div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;'><a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode"><img src="http://storage.ie6countdown.com/assets/100/images/banners/warning_bar_0000_us.jpg" border="0" height="42" width="820" alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today." /></a></div><![endif]-->

<!--ZOOMRESTART-->
<p class="p_Normal">Purpose and Implementation in Alpha AXP Emulation</p>
<p class="p_Normal">&nbsp;</p>
<h3 class="p_Heading3" style="page-break-after: avoid;"><span class="f_Heading3">Overview</span></h3>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">The Alpha AXP architecture, like many RISC designs, can trigger floating-point exceptions (invalid operation, overflow, underflow, inexact, etc.) during execution of floating-point instructions. In order to faithfully emulate the hardware—and to enable correct software or PALcode trap repair—it is necessary to identify which operand(s) were the source of the exceptional condition.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">This is particularly important for binary instructions (such as ADD, SUB, DIV, MUL) where either or both operands could be exceptional (for example, a denormal input, NaN, or division by zero). Likewise, some unary instructions (such as CVTQS, SQRTS) have only one relevant source, but for completeness and uniform trap handling, we use the same mechanism.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">Why a Bitmask?</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal"><span style="font-weight: bold;">Compact Representation:</span></p>
<p class="p_Normal">A single 32-bit bitmask can represent any combination of Alpha registers (FP or integer). This allows the emulator and trap handler to track and repair all exceptional operands, not just the first detected.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal"><span style="font-weight: bold;">Faithful Exception Repair:</span></p>
<p class="p_Normal">Alpha’s architectural model expects trap handlers to “repair” exceptional source values (such as canonicalizing denormals), then resume or re-execute the instruction. The bitmask tells the trap handler exactly which operand(s) to inspect and fix.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal"><span style="font-weight: bold;">Scalability:</span></p>
<p class="p_Normal">The bitmask approach scales seamlessly to binary, ternary, or even vector/SIMD instructions, allowing future extension of the emulator without redesign.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal"><span style="font-weight: bold;">Debuggability:</span></p>
<p class="p_Normal">When debugging complex exception scenarios, the bitmask provides a direct mapping to which register(s) were involved, aiding log output, diagnostics, and architectural trace.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal"><span style="font-weight: bold;">How the Bitmask is Used:</span></p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">In the Grain (Instruction Handler):</p>
<p class="p_Normal" style="text-indent: 0; padding-left: 13px; margin-left: 0;"><span class="f_Normal" style="font-family: Arial,'Lucida Sans Unicode','Lucida Grande','Lucida Sans';display:inline-block;width:13px;margin-left:-13px">&#8226;</span>When a floating-point exception is detected, the grain constructs a bitmask of the source operand(s) involved using a macro (for example, ALPHA_EXCEPTION_SRC_BITMASK(m_ra, m_rb)).</p>
<p class="p_Normal" style="text-indent: 0; padding-left: 13px; margin-left: 0;"><span class="f_Normal" style="font-family: Arial,'Lucida Sans Unicode','Lucida Grande','Lucida Sans';display:inline-block;width:13px;margin-left:-13px">&#8226;</span>This bitmask is stored in the ExceptionInfo structure passed to the raiseException function.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal"><span style="font-weight: bold;">In RaiseException / Trap Handling:</span></p>
<p class="p_Normal" style="text-indent: 0; padding-left: 13px; margin-left: 0;"><span class="f_Normal" style="font-family: Arial,'Lucida Sans Unicode','Lucida Grande','Lucida Sans';display:inline-block;width:13px;margin-left:-13px">&#8226;</span>The trap handler receives the ExceptionInfo and its source bitmask.</p>
<p class="p_Normal" style="text-indent: 0; padding-left: 13px; margin-left: 0;"><span class="f_Normal" style="font-family: Arial,'Lucida Sans Unicode','Lucida Grande','Lucida Sans';display:inline-block;width:13px;margin-left:-13px">&#8226;</span>For each bit set in the bitmask, the handler inspects (and, if needed, repairs) the value in the corresponding register before resuming or retrying the faulting instruction.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal"><span style="font-weight: bold;">Example</span></p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">For a unary instruction (for example, SQRTS), only m_ra is set:</p>
<p class="p_CodeExample"><span class="f_CodeExample">bitmask&nbsp;=&nbsp;(1U&nbsp;&lt;&lt;&nbsp;m_ra);</span></p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">For a binary instruction (for example, DIVS F2,F3,F4), both m_ra and m_rb may be exceptional:</p>
<p class="p_CodeExample"><span class="f_CodeExample">bitmask&nbsp;=&nbsp;(1U&nbsp;&lt;&lt;&nbsp;m_ra)&nbsp;|&nbsp;(1U&nbsp;&lt;&lt;&nbsp;m_rb);</span></p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">For CVTTQ (where only F31 is allowed as source), the bitmask is always:</p>
<p class="p_CodeExample"><span class="f_CodeExample">bitmask&nbsp;=&nbsp;(1U&nbsp;&lt;&lt;&nbsp;31);</span></p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal"><span style="font-weight: bold;">Summary</span></p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">The exception source bitmask is an architectural feature in your Alpha AXP emulator that enables precise, efficient, and scalable tracking of which operand(s) triggered a floating-point exception. This mechanism supports faithful exception repair and emulation accuracy, and is a best-practice approach for any high-fidelity instruction-level emulator.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">&nbsp;</p>

<!--ZOOMSTOP-->
</div></div>
<script type="text/javascript">



function normHeaders() {
 var topicHeadHeight =  $("#idheaderbg > table").first().height() + 1,
	 $topicHeaderBox = $("#idheader"),
	 $topicContentBox = $("#idcontent"),
	 $navHeader = $("#navbar", parent.document),			 
	$navBox = $("div#hmnavframe", parent.document),
	 navHeaderHeight = $navHeader.height();
 if (topicHeadHeight != navHeaderHeight) {
	 $navHeader.css("height",topicHeadHeight + "px");
	 $navBox.css("top", topicHeadHeight + "px");
	 $topicHeaderBox.css("height", topicHeadHeight + "px");
		if ($topicHeaderBox.css("position") == "fixed"){
			$topicContentBox.css("margin-top", topicHeadHeight + "px");
			}
		}
    }
			 
  $(document).ready(function(){
    $(window).on('resize', function() {
      var y = $('#idheader').height(); 
      $('#idcontent').css('margin-top', y);
      var par = window.parent;
      if ($( par ).width() <= $( window ).width()+20) {
        $('#idheader').css('position', 'relative');
        $('#idcontent').css('margin-top', 0);
        $('#idbacktotop').css('display', 'block');
        $('.hmanchor').css('margin-top', -20);
	$('.hmanchor').css('padding-top', 20);
      }
      else {
        $('#idheader').css('position', 'fixed');
        $('#idcontent').css('margin-top', $('#idheader').height());
        $('#idbacktotop').css('display', 'none');
        $('.hmanchor').css('margin-top', -y-20);
		$('.hmanchor').css('padding-top', y+20);
		$("div#hmsplitter", parent.document).css('width', '3px');
      }
	normHeaders();
    });
    
	 $(window).resize(); //trigger event for initially small displays
  });
 

if ((!parent.hmNavigationFrame) && (parent.location) && (parent.location.href)) { $('.sync-toc').show();$('p.crumbs').hide();}

</script>
</body>
</html>
