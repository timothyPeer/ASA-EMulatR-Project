<!DOCTYPE html>
<html>
<head>
   <title>Introduction &gt; Platform Architectures &gt; Alpha Architecture &gt; Instruction Grains &gt; Instruction Grain Data Flow — Overview &gt; Grain Execution - Load Instruction</title>
   <meta name="viewport" content="width=device-width, initial-scale=1">
   <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />   
   <meta http-equiv="X-UA-Compatible" content="IE=edge" />
   <meta name="generator" content="Help &amp; Manual" />
   <meta name="keywords" content="" />
   <meta name="description" content="This section describes the complete data and control flow for a memory access instruction grain (such as LDT_InstructionGrain::execute()) in the ASA-EMulatR. Instruction grains..." />
   <link type="text/css" href="default.css" rel="stylesheet" />
   <link type="text/css" href="custom.css" rel="stylesheet" />

   <style TYPE="text/css" media="screen"> 
      html, body { margin:0; 
        padding:0; 
        background: #ffffff; 
      } 
      div#printheader { display: none; }
      #idheader { 
        width:100%; 
        min-height: 60px; 
        padding: 0; 
        margin: 0;
        position: fixed;
        top: 0;
        background: #2C5D88;
        z-index: 2;
      } 
      /* The "min-height" for "#idheader table" ensures that the (blue) header of the topic
         has at least the same height as the header of the navigation panel left of it */
      #idheader table { min-height: 59px;}             
      #idheader h1 span { color: #FFF }     
      #idnav {
        text-align: right;
        width: 126px;
        vertical-align: middle;        
      } 
      #idnav a { text-decoration: none }
      #idnav span {
        display: inline-block;
        width: 24px;
        height: 24px;
        margin-left: 4px;
        background:url('hm_webhelp_buttons_grey.png') top left no-repeat;
      } 
      #idnav a span {
        background-image:url('hm_webhelp_buttons_white.png');
      } 
      #idnav a span:hover {
        background-image:url('hm_webhelp_buttons_orange.png');
      } 
      #idnav span.hmbtnprev { background-position: 0 -32px }
      #idnav span.hmbtnnext { background-position: -24px -32px }
      #idnav span.hmbtntop  { background-position: -48px -32px }
      #idnav span.hmbtntoggle  { width: 20px; background-position: -70px -32px }
      #idnav span.hmbtnprint  { background-position: -88px -32px }

      #callout-table, #overview-table {display:block; position:relative; top:0; left:0;}
      #callout-icon {display:block; position:absolute; top:-11px; left:-11px;}
      #callout-icon-flag {display:block; position:absolute; top:-11px; left:-8px;}
      #callout-table a {text-decoration: none; color: blue;}
      #callout-table a:visited {text-decoration: none; color: blue;}
      #overview-table a {text-decoration: none; color: black;}
      #overview-table a:visited {text-decoration: none; color: black;}
      #callout-table a:hover, #overview-table a:hover {text-decoration: underline;}       
      p.help-url { margin: 20px 0 5px 0; text-align: center; }
	  p.help-url a:link { font-size: 50%; text-decoration: none; color: black; }
	  p.help-url a:visited { color: black; }
	  p.help-url a:hover { font-size: 95%; text-decoration: underline; }
      #switchtoggles { text-align: right; padding: 0 2px 0 0; font-size: 90%; } 
      .sync-toc { color: #FFF; font-size: 8pt; font-weight: bold; display: none; }
      .sync-toc a { color: #FFF; text-decoration: none; font-weight: bold;}
      .sync-toc a:visited { color: #FFF; }
      .sync-toc a:hover { text-decoration: underline; }
	  a#printbuttonlink { cursor: pointer; }
      a.hmanchor { display: inline-block; margin-top: -4em; padding-top: 4em; }  
   </style>
   <style TYPE="text/css" media="print">
      div#idheader, img.dropdown-toggle-icon, p.help-url { display:none } 
   </style>
   
   <script type="text/javascript" src="jquery.js"></script>
   <script type="text/javascript" src="helpman_settings.js"></script>
   <script type="text/javascript" src="helpman_topicinit.js"></script>

   <script type="text/javascript">
     HMSyncTOC("index.html", "instruction-stack-exection.html");
   </script>
   <script type="text/javascript" src="highlight.js"></script>
   <script type="text/javascript">
     $(document).ready(function(){highlight();});
   </script>
</head>
<body>


<div id="printheader"><h1 class="p_Heading1" style="page-break-after: avoid;"><span class="f_Heading1">Grain Execution - Load Instruction</span></h1>
</div>
<div id="idheader">
<div id="idheaderbg">
<table style="width:100%;border:none;margin:0px;" cellspacing="0" cellpadding="0"> 
  <tr>
    <td class="topichead" style="text-align:left; vertical-align:middle">
      <p class="sync-toc">&lt;&lt; <a rel="nofollow" href="index.html?instruction-stack-exection.html" target="_top">Click to Display Table of Contents</a> &gt;&gt;</p>
      <p class="crumbs"><b>Navigation:</b>&nbsp;
      
      <a href="introduction.html">Introduction</a> &gt; <a href="platform-architectures.html">Platform Architectures</a> &gt; <a href="architecture.html">Alpha Architecture</a> &gt; <a href="instruction-grain.html">Instruction Grains</a> &gt; <a href="instructions-introduction.html">Instruction Grain Data Flow — Overview</a>&nbsp;&gt;</p>
   
      <h1 class="p_Heading1" style="page-break-after: avoid;"><span class="f_Heading1">Grain Execution - Load Instruction</span></h1>

    </td>
    <td class="topichead" id="idnav">
      
      <a href="instructions-introduction.html" title="Previous Topic"><span class="hmbtnprev"></span></a>
      <a href="instructions-introduction.html" title="Parent Chapter"><span class="hmbtntop"></span></a>
      <a href="execution-stack-breakdown-for-.html" title="Next Topic"><span class="hmbtnnext"></span></a>
      
    </td>
  </tr>  
</table>
</div>
</div>  

<div id="idcontent"><div id="innerdiv">
<!-- Ask Internet Explorer 6.users to update their obsolete and dangerous browser --> 
<!--[if lt IE 7]><div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;'><a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode"><img src="http://storage.ie6countdown.com/assets/100/images/banners/warning_bar_0000_us.jpg" border="0" height="42" width="820" alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today." /></a></div><![endif]-->

<!--ZOOMRESTART-->
<p class="p_Normal">This section describes the complete data and control flow for a memory access instruction grain (such as <span class="f_CodeExample">LDT_InstructionGrain::execute()</span>) in the ASA-EMulatR. Instruction grains are the fundamental execution units responsible for decoding operands, computing effective addresses, invoking the virtual memory system, and handling all exceptions or TLB events encountered during instruction execution.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">When a memory access instruction (e.g., LDT, LDQ, STT) executes:</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal" style="text-indent: 0; padding-left: 13px; margin-left: 0;"><span class="f_Normal" style="font-family: Arial,'Lucida Sans Unicode','Lucida Grande','Lucida Sans';display:inline-block;width:13px;margin-left:-13px">&#8226;</span>The grain decodes the effective virtual address using base register and displacement.</p>
<p class="p_Normal" style="text-indent: 0; padding-left: 13px; margin-left: 0;"><span class="f_Normal" style="font-family: Arial,'Lucida Sans Unicode','Lucida Grande','Lucida Sans';display:inline-block;width:13px;margin-left:-13px">&#8226;</span>It calls into the memory system to perform a read or write operation using the computed virtual address.</p>
<p class="p_Normal" style="text-indent: 0; padding-left: 13px; margin-left: 0;"><span class="f_Normal" style="font-family: Arial,'Lucida Sans Unicode','Lucida Grande','Lucida Sans';display:inline-block;width:13px;margin-left:-13px">&#8226;</span>The memory system performs TLB translation, handles any TLB miss or page fault, and reads or writes the appropriate physical memory location.</p>
<p class="p_Normal" style="text-indent: 0; padding-left: 13px; margin-left: 0;"><span class="f_Normal" style="font-family: Arial,'Lucida Sans Unicode','Lucida Grande','Lucida Sans';display:inline-block;width:13px;margin-left:-13px">&#8226;</span>The resulting value is returned to the grain and stored in the destination register.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">This flow ensures that all aspects of address translation, TLB management, and page table interaction are faithfully modeled—matching the timing, exception, and caching behavior expected by Alpha hardware and software. The following diagram and narrative trace each major step, from instruction decode through TLB and page table lookup, to final memory access and register update.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal"><span class="f_Heading3">Instruction Grain (e.g., LDT_InstructionGrain::execute())</span></p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">Data Flow Summary (example: InstructionGrain - LDT)</p>
<p class="p_Normal" style="text-indent: 0; padding-left: 13px; margin-left: 0;"><span class="f_Normal" style="font-family: Arial,'Lucida Sans Unicode','Lucida Grande','Lucida Sans';display:inline-block;width:13px;margin-left:-13px">&#8226;</span>This is the decoded instruction implementation.</p>
<p class="p_Normal" style="text-indent: 0; padding-left: 13px; margin-left: 0;"><span class="f_Normal" style="font-family: Arial,'Lucida Sans Unicode','Lucida Grande','Lucida Sans';display:inline-block;width:13px;margin-left:-13px">&#8226;</span>It computes the effective virtual address (VA) using base register + displacement.</p>
<p class="p_Normal" style="text-indent: 0; padding-left: 13px; margin-left: 0;"><span class="f_Normal" style="font-family: Arial,'Lucida Sans Unicode','Lucida Grande','Lucida Sans';display:inline-block;width:13px;margin-left:-13px">&#8226;</span>Calls into the memory system to perform a read via virtual address.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_CodeExample" style="margin: 0 0 0 13px;"><span class="f_CodeExample">bool&nbsp;success&nbsp;=&nbsp;memorySystem-&gt;readVirtualMemory(cpuId,&nbsp;virtualAddr,&nbsp;value,&nbsp;size);</span></p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal"><span class="f_Heading3">AlphaMemorySystem::readVirtualMemory()</span></p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal" style="text-indent: 0; padding-left: 13px; margin-left: 0;"><span class="f_Normal" style="font-family: Arial,'Lucida Sans Unicode','Lucida Grande','Lucida Sans';display:inline-block;width:13px;margin-left:-13px">&#8226;</span>This function handles:</p>
<p class="p_Normal" style="text-indent: 0; padding-left: 26px; margin-left: 0;"><span class="f_Normal" style="font-family: 'Courier New';display:inline-block;width:13px;margin-left:-13px">o</span>TLB lookup (for fast VA→PA translation)</p>
<p class="p_Normal" style="text-indent: 0; padding-left: 26px; margin-left: 0;"><span class="f_Normal" style="font-family: 'Courier New';display:inline-block;width:13px;margin-left:-13px">o</span>If TLB miss: calls the page table walker (e.g., SimplePageTable)</p>
<p class="p_Normal" style="text-indent: 0; padding-left: 26px; margin-left: 0;"><span class="f_Normal" style="font-family: 'Courier New';display:inline-block;width:13px;margin-left:-13px">o</span>Caches the result in TLB</p>
<p class="p_Normal" style="text-indent: 0; padding-left: 13px; margin-left: 0;"><span class="f_Normal" style="font-family: Arial,'Lucida Sans Unicode','Lucida Grande','Lucida Sans';display:inline-block;width:13px;margin-left:-13px">&#8226;</span>Once translated: it reads from physical memory using the result.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">Typical internal steps:</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_CodeExample" style="margin: 0 0 0 13px;"><span class="f_CodeExample" style="font-size: 11px;">TranslationResult&nbsp;tr&nbsp;=&nbsp;tlbSystem-&gt;translateAddress(va);</span></p>
<p class="p_CodeExample" style="margin: 0 0 0 13px;"><span class="f_CodeExample" style="font-size: 11px;">if&nbsp;(!tr.isValid())&nbsp;{</span></p>
<p class="p_CodeExample" style="margin: 0 0 0 13px;"><span class="f_CodeExample" style="font-size: 11px;">&nbsp;&nbsp;&nbsp;&nbsp;handleTLBMiss();</span></p>
<p class="p_CodeExample" style="margin: 0 0 0 13px;"><span class="f_CodeExample" style="font-size: 11px;">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;</span></p>
<p class="p_CodeExample" style="margin: 0 0 0 13px;"><span class="f_CodeExample" style="font-size: 11px;">}</span></p>
<p class="p_CodeExample" style="margin: 0 0 0 13px;"><span class="f_CodeExample" style="font-size: 11px;">readPhysicalMemory(tr.physicalAddress(),&nbsp;...);</span></p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal"><span class="f_Heading3">TLBSystem::translateAddress()</span></p>
<p class="p_Normal" style="text-indent: 0; padding-left: 26px; margin-left: 0;"><span class="f_Normal" style="font-family: 'Courier New';display:inline-block;width:13px;margin-left:-13px">o</span>Checks the per-CPU TLB for a matching VA &amp; ASN.</p>
<p class="p_Normal" style="text-indent: 0; padding-left: 26px; margin-left: 0;"><span class="f_Normal" style="font-family: 'Courier New';display:inline-block;width:13px;margin-left:-13px">o</span>If found: returns physical page number (PPN).</p>
<p class="p_Normal" style="text-indent: 0; padding-left: 26px; margin-left: 0;"><span class="f_Normal" style="font-family: 'Courier New';display:inline-block;width:13px;margin-left:-13px">o</span>If not found: triggers miss handling (usually calls AlphaMemorySystem::handleTLBMiss()).</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal"><span class="f_Heading3">AlphaMemorySystem::handleTLBMiss()</span></p>
<p class="p_Normal" style="text-indent: 0; padding-left: 26px; margin-left: 0;"><span class="f_Normal" style="font-family: 'Courier New';display:inline-block;width:13px;margin-left:-13px">o</span>Calls the page table (e.g., SimplePageTable::lookup()).</p>
<p class="p_Normal" style="text-indent: 0; padding-left: 26px; margin-left: 0;"><span class="f_Normal" style="font-family: 'Courier New';display:inline-block;width:13px;margin-left:-13px">o</span>Converts VA → PPN.</p>
<p class="p_Normal" style="text-indent: 0; padding-left: 26px; margin-left: 0;"><span class="f_Normal" style="font-family: 'Courier New';display:inline-block;width:13px;margin-left:-13px">o</span>Loads TLB entry for future reference.</p>
<p class="p_Normal">&nbsp;</p>
<h3 class="p_Heading3" style="page-break-after: avoid;"><span class="f_Heading3">// TODO - Deprecated - SimplePageTable::lookup()</span></h3>
<p class="p_Normal" style="text-indent: 0; padding-left: 13px; margin-left: 0;"><span class="f_Normal" style="font-family: Arial,'Lucida Sans Unicode','Lucida Grande','Lucida Sans';display:inline-block;width:13px;margin-left:-13px">&#8226;</span>Performs basic translation:</p>
<p class="p_Normal" style="text-indent: 0; padding-left: 26px; margin-left: 0;"><span class="f_Normal" style="font-family: 'Courier New';display:inline-block;width:13px;margin-left:-13px">o</span><span class="f_CodeExample">vpn = va &gt;&gt; 13</span> (for 8 KB pages)</p>
<p class="p_Normal" style="text-indent: 0; padding-left: 26px; margin-left: 0;"><span class="f_Normal" style="font-family: 'Courier New';display:inline-block;width:13px;margin-left:-13px">o</span>Looks up vpn in internal structure like QHash&lt;vpn, PTE&gt;</p>
<p class="p_Normal" style="text-indent: 0; padding-left: 26px; margin-left: 0;"><span class="f_Normal" style="font-family: 'Courier New';display:inline-block;width:13px;margin-left:-13px">o</span>Returns mapped physical page number (PPN)</p>
<p class="p_Normal" style="text-indent: 0; padding-left: 13px; margin-left: 0;"><span class="f_Normal" style="font-family: Arial,'Lucida Sans Unicode','Lucida Grande','Lucida Sans';display:inline-block;width:13px;margin-left:-13px">&#8226;</span>Combines <span class="f_CodeExample" style="font-size: 11px;">PPN &lt;&lt; 13 | (va &amp; 0x1FFF)</span> to form full physical address.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">Data Flow Summary (for LDT)</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_CodeExample"><span class="f_CodeExample" style="font-size: 11px;">InstructionGrain::execute()</span></p>
<p class="p_CodeExample"><span class="f_CodeExample" style="font-size: 11px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;↓</span></p>
<p class="p_CodeExample"><span class="f_CodeExample" style="font-size: 11px;">AlphaMemorySystem::readVirtualMemory()</span></p>
<p class="p_CodeExample"><span class="f_CodeExample" style="font-size: 11px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;↓</span></p>
<p class="p_CodeExample"><span class="f_CodeExample" style="font-size: 11px;">TLBSystem::translateAddress()</span></p>
<p class="p_CodeExample"><span class="f_CodeExample" style="font-size: 11px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;↓&nbsp;(miss)</span></p>
<p class="p_CodeExample"><span class="f_CodeExample" style="font-size: 11px;">AlphaMemorySystem::handleTLBMiss()</span></p>
<p class="p_CodeExample"><span class="f_CodeExample" style="font-size: 11px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;↓</span></p>
<p class="p_CodeExample"><span class="f_CodeExample" style="font-size: 11px;">SimplePageTable::lookup()</span></p>
<p class="p_CodeExample"><span class="f_CodeExample" style="font-size: 11px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;↓</span></p>
<p class="p_CodeExample"><span class="f_CodeExample" style="font-size: 11px;">(returns&nbsp;PPN,&nbsp;updates&nbsp;TLB)</span></p>
<p class="p_CodeExample"><span class="f_CodeExample" style="font-size: 11px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;↓</span></p>
<p class="p_CodeExample"><span class="f_CodeExample" style="font-size: 11px;">AlphaMemorySystem&nbsp;reads&nbsp;physical&nbsp;memory</span></p>
<p class="p_CodeExample"><span class="f_CodeExample" style="font-size: 11px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;↓</span></p>
<p class="p_CodeExample"><span class="f_CodeExample" style="font-size: 11px;">value&nbsp;returned&nbsp;to&nbsp;InstructionGrain,&nbsp;stored&nbsp;in&nbsp;FP&nbsp;register</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;</span></p>
<p class="p_SeeAlso" style="page-break-after: avoid;"><span class="f_SeeAlso">See Also. </span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;</span></p>
<p class="p_CodeExample"><span class="f_CodeExample" style="font-size: 11px;"><a href="alphamemorysystem-claude.html" class="topiclink">AlphaMemorySystem</a>&nbsp;<a href="tlbsystem-class-dictionary.html" class="topiclink">TLBSystem&nbsp;-&nbsp;Translation&nbsp;Buffer&nbsp;Table&nbsp;(TLB)</a>&nbsp;<a href="alphainstructiongrain-class-dictionary.html" class="topiclink">AlphaInstructionGrain</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>

<!--ZOOMSTOP-->
</div></div>
<script type="text/javascript">



function normHeaders() {
 var topicHeadHeight =  $("#idheaderbg > table").first().height() + 1,
	 $topicHeaderBox = $("#idheader"),
	 $topicContentBox = $("#idcontent"),
	 $navHeader = $("#navbar", parent.document),			 
	$navBox = $("div#hmnavframe", parent.document),
	 navHeaderHeight = $navHeader.height();
 if (topicHeadHeight != navHeaderHeight) {
	 $navHeader.css("height",topicHeadHeight + "px");
	 $navBox.css("top", topicHeadHeight + "px");
	 $topicHeaderBox.css("height", topicHeadHeight + "px");
		if ($topicHeaderBox.css("position") == "fixed"){
			$topicContentBox.css("margin-top", topicHeadHeight + "px");
			}
		}
    }
			 
  $(document).ready(function(){
    $(window).on('resize', function() {
      var y = $('#idheader').height(); 
      $('#idcontent').css('margin-top', y);
      var par = window.parent;
      if ($( par ).width() <= $( window ).width()+20) {
        $('#idheader').css('position', 'relative');
        $('#idcontent').css('margin-top', 0);
        $('#idbacktotop').css('display', 'block');
        $('.hmanchor').css('margin-top', -20);
	$('.hmanchor').css('padding-top', 20);
      }
      else {
        $('#idheader').css('position', 'fixed');
        $('#idcontent').css('margin-top', $('#idheader').height());
        $('#idbacktotop').css('display', 'none');
        $('.hmanchor').css('margin-top', -y-20);
		$('.hmanchor').css('padding-top', y+20);
		$("div#hmsplitter", parent.document).css('width', '3px');
      }
	normHeaders();
    });
    
	 $(window).resize(); //trigger event for initially small displays
  });
 

if ((!parent.hmNavigationFrame) && (parent.location) && (parent.location.href)) { $('.sync-toc').show();$('p.crumbs').hide();}

</script>
</body>
</html>
