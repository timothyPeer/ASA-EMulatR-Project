<!DOCTYPE html>
<html>
<head>
   <title>Introduction &gt; Platform Architectures &gt; Alpha Architecture &gt; Virtual Address Space — Overview &gt; Memory Management &gt; SafeMemory - TODO</title>
   <meta name="viewport" content="width=device-width, initial-scale=1">
   <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />   
   <meta http-equiv="X-UA-Compatible" content="IE=edge" />
   <meta name="generator" content="Help &amp; Manual" />
   <meta name="keywords" content="SafeMemory" />
   <meta name="description" content="Alpha/VAX Floating-Point Exception Handling: Status and Trap Model Reference" />
   <link type="text/css" href="default.css" rel="stylesheet" />
   <link type="text/css" href="custom.css" rel="stylesheet" />

   <style TYPE="text/css" media="screen"> 
      html, body { margin:0; 
        padding:0; 
        background: #ffffff; 
      } 
      div#printheader { display: none; }
      #idheader { 
        width:100%; 
        min-height: 60px; 
        padding: 0; 
        margin: 0;
        position: fixed;
        top: 0;
        background: #2C5D88;
        z-index: 2;
      } 
      /* The "min-height" for "#idheader table" ensures that the (blue) header of the topic
         has at least the same height as the header of the navigation panel left of it */
      #idheader table { min-height: 59px;}             
      #idheader h1 span { color: #FFF }     
      #idnav {
        text-align: right;
        width: 126px;
        vertical-align: middle;        
      } 
      #idnav a { text-decoration: none }
      #idnav span {
        display: inline-block;
        width: 24px;
        height: 24px;
        margin-left: 4px;
        background:url('hm_webhelp_buttons_grey.png') top left no-repeat;
      } 
      #idnav a span {
        background-image:url('hm_webhelp_buttons_white.png');
      } 
      #idnav a span:hover {
        background-image:url('hm_webhelp_buttons_orange.png');
      } 
      #idnav span.hmbtnprev { background-position: 0 -32px }
      #idnav span.hmbtnnext { background-position: -24px -32px }
      #idnav span.hmbtntop  { background-position: -48px -32px }
      #idnav span.hmbtntoggle  { width: 20px; background-position: -70px -32px }
      #idnav span.hmbtnprint  { background-position: -88px -32px }

      #callout-table, #overview-table {display:block; position:relative; top:0; left:0;}
      #callout-icon {display:block; position:absolute; top:-11px; left:-11px;}
      #callout-icon-flag {display:block; position:absolute; top:-11px; left:-8px;}
      #callout-table a {text-decoration: none; color: blue;}
      #callout-table a:visited {text-decoration: none; color: blue;}
      #overview-table a {text-decoration: none; color: black;}
      #overview-table a:visited {text-decoration: none; color: black;}
      #callout-table a:hover, #overview-table a:hover {text-decoration: underline;}       
      p.help-url { margin: 20px 0 5px 0; text-align: center; }
	  p.help-url a:link { font-size: 50%; text-decoration: none; color: black; }
	  p.help-url a:visited { color: black; }
	  p.help-url a:hover { font-size: 95%; text-decoration: underline; }
      #switchtoggles { text-align: right; padding: 0 2px 0 0; font-size: 90%; } 
      .sync-toc { color: #FFF; font-size: 8pt; font-weight: bold; display: none; }
      .sync-toc a { color: #FFF; text-decoration: none; font-weight: bold;}
      .sync-toc a:visited { color: #FFF; }
      .sync-toc a:hover { text-decoration: underline; }
	  a#printbuttonlink { cursor: pointer; }
      a.hmanchor { display: inline-block; margin-top: -4em; padding-top: 4em; }  
   </style>
   <style TYPE="text/css" media="print">
      div#idheader, img.dropdown-toggle-icon, p.help-url { display:none } 
   </style>
   
   <script type="text/javascript" src="jquery.js"></script>
   <script type="text/javascript" src="helpman_settings.js"></script>
   <script type="text/javascript" src="helpman_topicinit.js"></script>

   <script type="text/javascript">
     HMSyncTOC("index.html", "safememory-claude.html");
   </script>
   <script type="text/javascript" src="highlight.js"></script>
   <script type="text/javascript">
     $(document).ready(function(){highlight();});
   </script>
</head>
<body>


<div id="printheader"><h1 class="p_Heading1" style="page-break-after: avoid;"><span class="f_Heading1">SafeMemory - TODO</span></h1>
</div>
<div id="idheader">
<div id="idheaderbg">
<table style="width:100%;border:none;margin:0px;" cellspacing="0" cellpadding="0"> 
  <tr>
    <td class="topichead" style="text-align:left; vertical-align:middle">
      <p class="sync-toc">&lt;&lt; <a rel="nofollow" href="index.html?safememory-claude.html" target="_top">Click to Display Table of Contents</a> &gt;&gt;</p>
      <p class="crumbs"><b>Navigation:</b>&nbsp;
      
      <a href="introduction.html">Introduction</a> &gt; <a href="platform-architectures.html">Platform Architectures</a> &gt; <a href="architecture.html">Alpha Architecture</a> &gt; <a href="virtualization-address-space.html">Virtual Address Space — Overview</a> &gt; <a href="memory-management.html">Memory Management</a>&nbsp;&gt;</p>
   
      <h1 class="p_Heading1" style="page-break-after: avoid;"><span class="f_Heading1">SafeMemory - TODO</span></h1>

    </td>
    <td class="topichead" id="idnav">
      
      <a href="translation-lookaside-buffer-(.html" title="Previous Topic"><span class="hmbtnprev"></span></a>
      <a href="memory-management.html" title="Parent Chapter"><span class="hmbtntop"></span></a>
      <a href="virtual-to-physical-address-tr.html" title="Next Topic"><span class="hmbtnnext"></span></a>
      
    </td>
  </tr>  
</table>
</div>
</div>  

<div id="idcontent"><div id="innerdiv">
<!-- Ask Internet Explorer 6.users to update their obsolete and dangerous browser --> 
<!--[if lt IE 7]><div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;'><a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode"><img src="http://storage.ie6countdown.com/assets/100/images/banners/warning_bar_0000_us.jpg" border="0" height="42" width="820" alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today." /></a></div><![endif]-->

<!--ZOOMRESTART-->
<h3 class="p_Heading3" style="page-break-after: avoid;"><span class="f_Heading3">Alpha/VAX Floating-Point Exception Handling: Status and Trap Model Reference</span></h3>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">This document describes the logic for exception and trap delivery in all qualified Alpha AXP and VAX arithmetic instruction grains (ADD, SUB, MUL, DIV, SQRT, etc.). Each instruction variant uses one of three models:</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">Case 1: Trap Only if Both – OptimizedExceptionStatusRegister AND FPCR trap enable checked (masked model)</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">Case 2: Trap Always – OptimizedExceptionStatusRegister only (unmasked model, FPCR trap enables ignored)</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">Case 3: Status Only – OptimizedExceptionStatusRegister only, never traps (summary only)</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">Use this table and code snippets to implement or audit all arithmetic grains for correct architectural behavior.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">Table: Trap/Status Model by Instruction Suffix</p>
<p class="p_Normal">Suffix / Variant &nbsp; &nbsp; &nbsp; &nbsp;OptimizedExceptionStatusRegister Checked &nbsp; &nbsp; &nbsp; &nbsp;FPCR Trap Enable Checked &nbsp; &nbsp; &nbsp; &nbsp;Trap Always? &nbsp; &nbsp; &nbsp; &nbsp;Trap Only if Both? &nbsp; &nbsp; &nbsp; &nbsp;Status Only?</p>
<p class="p_Normal">(none), /C, /D &nbsp; &nbsp; &nbsp; &nbsp;Yes &nbsp; &nbsp; &nbsp; &nbsp;Yes &nbsp; &nbsp; &nbsp; &nbsp;No &nbsp; &nbsp; &nbsp; &nbsp;Yes &nbsp; &nbsp; &nbsp; &nbsp;No</p>
<p class="p_Normal">/SU, /SUI, /SUIC &nbsp; &nbsp; &nbsp; &nbsp;Yes &nbsp; &nbsp; &nbsp; &nbsp;Yes &nbsp; &nbsp; &nbsp; &nbsp;No &nbsp; &nbsp; &nbsp; &nbsp;Yes &nbsp; &nbsp; &nbsp; &nbsp;No</p>
<p class="p_Normal">/SUD, /SUID, /SUIM &nbsp; &nbsp; &nbsp; &nbsp;Yes &nbsp; &nbsp; &nbsp; &nbsp;Yes &nbsp; &nbsp; &nbsp; &nbsp;No &nbsp; &nbsp; &nbsp; &nbsp;Yes &nbsp; &nbsp; &nbsp; &nbsp;No</p>
<p class="p_Normal">/U, /UM, /UC, /UD &nbsp; &nbsp; &nbsp; &nbsp;Yes &nbsp; &nbsp; &nbsp; &nbsp;No &nbsp; &nbsp; &nbsp; &nbsp;Yes &nbsp; &nbsp; &nbsp; &nbsp;No &nbsp; &nbsp; &nbsp; &nbsp;No</p>
<p class="p_Normal">/M, /SUM, /SUID &nbsp; &nbsp; &nbsp; &nbsp;Yes &nbsp; &nbsp; &nbsp; &nbsp;No &nbsp; &nbsp; &nbsp; &nbsp;No &nbsp; &nbsp; &nbsp; &nbsp;No &nbsp; &nbsp; &nbsp; &nbsp;Yes</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">&quot;Trap Always?&quot; means an exception is always delivered if occurred, regardless of FPCR trap enables.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">&quot;Trap Only if Both?&quot; means exception delivered only if both exception occurred AND FPCR trap enable is set.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">&quot;Status Only?&quot; means exception status is updated, but never traps.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">Canonical Code Patterns</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">Case 1: Trap Only if Both (Masked/Conditional Model)</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">[</p>
<p class="p_Normal">// Trap only if both the exception status bit is set and the FPCR trap enable is set</p>
<p class="p_Normal">if (status-&gt;hasInvalidOpOccurred() &amp;&amp; fpcr-&gt;hasFlag(ExceptionCategory::TRAP_INVALID_OP_ENABLE)) {</p>
<p class="p_Normal">cpu-&gt;RaiseException(ExceptionCategory::INVALID_OPERATION, pc, 0); return;</p>
<p class="p_Normal">}</p>
<p class="p_Normal">if (status-&gt;hasOverflowOccurred() &amp;&amp; fpcr-&gt;hasFlag(ExceptionCategory::TRAP_FLOATING_POINT_OVERFLOW_ENABLE)) {</p>
<p class="p_Normal">cpu-&gt;RaiseException(ExceptionCategory::FLOATING_POINT_OVERFLOW, pc, 0); return;</p>
<p class="p_Normal">}</p>
<p class="p_Normal">if (status-&gt;hasUnderflowOccurred() &amp;&amp; fpcr-&gt;hasFlag(ExceptionCategory::TRAP_FLOATING_POINT_UNDERFLOW_ENABLE)) {</p>
<p class="p_Normal">cpu-&gt;RaiseException(ExceptionCategory::FLOATING_POINT_UNDERFLOW, pc, 0); return;</p>
<p class="p_Normal">}</p>
<p class="p_Normal">if (status-&gt;hasInexactOccurred() &amp;&amp; fpcr-&gt;hasFlag(ExceptionCategory::TRAP_INEXACT_ENABLE)) {</p>
<p class="p_Normal">cpu-&gt;RaiseException(ExceptionCategory::INEXACT, pc, 0); return;</p>
<p class="p_Normal">}</p>
<p class="p_Normal">]</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">Use this model for all grains with suffixes: (none), /C, /D, /SU, /SUI, /SUIC, /SUD, /SUID, /SUIM.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">Case 2: Trap Always (Unmasked Model)</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">[</p>
<p class="p_Normal">// Trap always if the exception occurred, regardless of FPCR enable bits</p>
<p class="p_Normal">if (status-&gt;hasInvalidOpOccurred()) {</p>
<p class="p_Normal">cpu-&gt;RaiseException(ExceptionCategory::INVALID_OPERATION, pc, 0); return;</p>
<p class="p_Normal">}</p>
<p class="p_Normal">if (status-&gt;hasOverflowOccurred()) {</p>
<p class="p_Normal">cpu-&gt;RaiseException(ExceptionCategory::FLOATING_POINT_OVERFLOW, pc, 0); return;</p>
<p class="p_Normal">}</p>
<p class="p_Normal">if (status-&gt;hasUnderflowOccurred()) {</p>
<p class="p_Normal">cpu-&gt;RaiseException(ExceptionCategory::FLOATING_POINT_UNDERFLOW, pc, 0); return;</p>
<p class="p_Normal">}</p>
<p class="p_Normal">if (status-&gt;hasInexactOccurred()) {</p>
<p class="p_Normal">cpu-&gt;RaiseException(ExceptionCategory::INEXACT, pc, 0); return;</p>
<p class="p_Normal">}</p>
<p class="p_Normal">]</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">Use this model for all grains with suffixes: /U, /UM, /UC, /UD.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">Case 3: Status Only (Masked/Summary-Only Model)</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">[</p>
<p class="p_Normal">// Only update the OptimizedExceptionStatusRegister; do not raise any trap</p>
<p class="p_Normal">status-&gt;testInvalidOccurred(dtResult);</p>
<p class="p_Normal">status-&gt;testOverflowOccurred(dtResult);</p>
<p class="p_Normal">status-&gt;testUnderflowOccurred(dtResult);</p>
<p class="p_Normal">status-&gt;testInexactOccurred(dtA, dtResult);</p>
<p class="p_Normal">// No RaiseException called in this case</p>
<p class="p_Normal">]</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">Use this model for all grains with suffixes: /M, /SUM, /SUID, or any summary-only grain per the Alpha AXP architecture.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">Reserved Operand and Non-Arithmetic Grains</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">Reserved Operand Handling:</p>
<p class="p_Normal">Always check for reserved operand (e.g., NaN input) before arithmetic, and if detected, set the ReservedOperandOccurred flag in OptimizedExceptionStatusRegister and immediately trap:</p>
<p class="p_Normal">[</p>
<p class="p_Normal">if (std::isnan(srcA) || std::isnan(srcB)) {</p>
<p class="p_Normal">status-&gt;setFlag(OptimizedExceptionStatusRegister::StatusBit::ReservedOperandOccurred, true);</p>
<p class="p_Normal">cpu-&gt;RaiseException(ExceptionCategory::RESERVED_OPERAND_FAULT, pc, 0);</p>
<p class="p_Normal">return;</p>
<p class="p_Normal">}</p>
<p class="p_Normal">]</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">Non-Arithmetic Grains:</p>
<p class="p_Normal">OptimizedExceptionStatusRegister is generally only updated by FP arithmetic and FP conversion instructions. For integer or memory instructions, do not update FP exception status unless the Alpha architecture explicitly requires it (e.g., for certain CVT instructions).</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">Implementation Checklist</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">For each arithmetic instruction grain:</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal"> Always update OptimizedExceptionStatusRegister status bits after the operation.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal"> Use the correct trap/status pattern for the instruction's suffix (see above).</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal"> Only call RaiseException if the model allows.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal"> For summary-only (/M, /SUM, /SUID), do not call RaiseException—update status only.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal"> For reserved operand cases, update status and always trap immediately.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">References</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">Alpha AXP System Reference Manual, Table 4-18, Table C-8, Section 4.7.8</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">VAX Architecture Reference Manual, Ch. 11–13 (for S_Float, G_Float, exception handling)</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">Project header files: AlphaInstructionGrain.h, OptimizedExceptionStatusRegister.h, AlphaCPU.h</p>

<!--ZOOMSTOP-->
</div></div>
<script type="text/javascript">



function normHeaders() {
 var topicHeadHeight =  $("#idheaderbg > table").first().height() + 1,
	 $topicHeaderBox = $("#idheader"),
	 $topicContentBox = $("#idcontent"),
	 $navHeader = $("#navbar", parent.document),			 
	$navBox = $("div#hmnavframe", parent.document),
	 navHeaderHeight = $navHeader.height();
 if (topicHeadHeight != navHeaderHeight) {
	 $navHeader.css("height",topicHeadHeight + "px");
	 $navBox.css("top", topicHeadHeight + "px");
	 $topicHeaderBox.css("height", topicHeadHeight + "px");
		if ($topicHeaderBox.css("position") == "fixed"){
			$topicContentBox.css("margin-top", topicHeadHeight + "px");
			}
		}
    }
			 
  $(document).ready(function(){
    $(window).on('resize', function() {
      var y = $('#idheader').height(); 
      $('#idcontent').css('margin-top', y);
      var par = window.parent;
      if ($( par ).width() <= $( window ).width()+20) {
        $('#idheader').css('position', 'relative');
        $('#idcontent').css('margin-top', 0);
        $('#idbacktotop').css('display', 'block');
        $('.hmanchor').css('margin-top', -20);
	$('.hmanchor').css('padding-top', 20);
      }
      else {
        $('#idheader').css('position', 'fixed');
        $('#idcontent').css('margin-top', $('#idheader').height());
        $('#idbacktotop').css('display', 'none');
        $('.hmanchor').css('margin-top', -y-20);
		$('.hmanchor').css('padding-top', y+20);
		$("div#hmsplitter", parent.document).css('width', '3px');
      }
	normHeaders();
    });
    
	 $(window).resize(); //trigger event for initially small displays
  });
 

if ((!parent.hmNavigationFrame) && (parent.location) && (parent.location.href)) { $('.sync-toc').show();$('p.crumbs').hide();}

</script>
</body>
</html>
